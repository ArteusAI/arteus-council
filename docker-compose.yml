version: "3.9"

services:
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    ports:
      - "${BACKEND_PORT:-8001}:${BACKEND_PORT:-8001}"
    environment:
      - OPENROUTER_API_KEY=${OPENROUTER_API_KEY}
      - GIGACHAT_CREDENTIALS=${GIGACHAT_CREDENTIALS}
      - GIGACHAT_SCOPE=${GIGACHAT_SCOPE}
      - GIGACHAT_VERIFY_SSL=${GIGACHAT_VERIFY_SSL}
      - GIGACHAT_PARALLEL_DISABLED=${GIGACHAT_PARALLEL_DISABLED}
      - YANDEX_API_KEY=${YANDEX_API_KEY}
      - YANDEX_FOLDER_ID=${YANDEX_FOLDER_ID}
      - FIRECRAWL_API_KEY=${FIRECRAWL_API_KEY}
      - BACKEND_PORT=${BACKEND_PORT:-8001}
      - BASE_URL=${BASE_URL:-/}
      - CORS_ALLOW_ORIGINS=${CORS_ALLOW_ORIGINS:-}
    volumes:
      - data:/app/data

  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
      args:
        VITE_API_BASE: ${VITE_API_BASE:-http://localhost:${BACKEND_PORT:-8001}}
        BASE_URL: ${BASE_URL:-${VITE_BASE_PATH:-/}}
        BACKEND_PORT: ${BACKEND_PORT:-8001}
    ports:
      - "${FRONTEND_PORT:-5173}:80"
    depends_on:
      - backend

volumes:
  data:
